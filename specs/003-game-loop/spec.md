# Functional Spec: ระบบวงจรเกมและสถานะ (Game Loop & State Machine)

**Feature Branch**: `feature/003-game-loop`
**Created**: 2026-02-08
**Status**: Draft
**Input**: สร้างระบบ Game Loop และ State Machine พื้นฐาน

## User Scenarios & Testing

### User Story 1 - เวลาเดิน สัตว์เลี้ยงเปลี่ยน (The Heartbeat)
**ในฐานะ** ผู้เล่น
**ฉันต้องการ** ให้เวลาในเกมเดินไปเรื่อยๆ (Tick)
**เพื่อที่** ค่าสถานะของสัตว์เลี้ยง (หิว, สนุก) จะได้เปลี่ยนแปลงตามเวลา ไม่ใช่นิ่งสนิท

**Acceptance Scenarios**:
1. **Given** เปิดเกมค้างไว้, **When** เวลาผ่านไปทุกๆ 1 วินาที (1 Tick), **Then** ระบบต้องส่งสัญญาณ "Tick" เพื่อคำนวณค่าต่างๆ

### User Story 2 - สถานะกำหนดการกระทำ (State Machine)
**ในฐานะ** ผู้เล่น
**ฉันต้องการ** ให้สัตว์เลี้ยงมีสถานะชัดเจน (เช่น นอนหลับ, กินอาหาร)
**เพื่อที่** จะได้รู้ว่าทำอะไรกับมันได้บ้าง (เช่น ห้ามป้อนข้าวตอนนอน)

**Acceptance Scenarios**:
1. **Given** สัตว์เลี้ยงหลับอยู่ (`SLEEPING`), **When** ฉันกดป้อนข้าว, **Then** ระบบต้องปฏิเสธการกระทำนั้น
2. **Given** สัตว์เลี้ยงตื่น (`IDLE`), **When** สั่งให้นอน, **Then** สถานะต้องเปลี่ยนเป็น `SLEEPING` และเปลี่ยนกลับเมื่อสั่งตื่น

## Requirements

### Functional Requirements
- **FR-001**: ระบบต้องมี **Global Clock** (Game Loop) ที่ทำงานเป็นจังหวะคงที่ (Fixed Time Step) เหมาะกับเกม Simulation
- **FR-002**: ระบบต้องรองรับ **State** หลักดังนี้:
    - `IDLE`: ปกติ ยืนเฉยๆ หรือเดินเล่น
    - `SLEEPING`: นอนหลับ (ไม่หิวเพิ่ม, พลังงานเพิ่ม)
    - `EATING`: กำลังกิน (ล็อคอินพุตอื่นชั่วคราว)
    - `PLAYING`: กำลังเล่น (ล็อคอินพุตอื่นชั่วคราว)
    - `SICK`: ป่วย (ต้องรักษาก่อนทำอย่างอื่น)
    - `DEAD`: ตาย (จบเกม / Reset)
- **FR-003**: การเปลี่ยนสถานะ (Transition) ต้องผ่านเงื่อนไขที่กำหนดเท่านั้น (Strict Transitions)

## Success Criteria
- **SC-001**: หน้าจอ Debug แสดงเลข Tick ที่เพิ่มขึ้นเรื่อยๆ
- **SC-002**: สามารถเปลี่ยน State ไปมาได้ และมีการป้องกัน Invalid Transition (เช่น กินทั้งที่หลับ)
